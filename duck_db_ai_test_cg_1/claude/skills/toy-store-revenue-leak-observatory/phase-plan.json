{
  "schema_version": "1.0",
  "project_name": "toy-store-revenue-leak-observatory",
  "dialect": "duckdb",
  "iteration_count": 5,
  "stages": [
    {
      "stage_id": 1,
      "stage_name": "source_intake_and_profiling",
      "goal": "Register the raw CSV files, create clean source models, and confirm the real schema using on-disk profiles rather than memory.",
      "must_read_first": [
        "datasets/maven-fuzzy-factory/profiles/table-profiles.json",
        "datasets/maven-fuzzy-factory/profiles/key-integrity.json",
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/source-manifest.json",
        ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-01-source-intake.md"
      ],
      "outputs": [
        "src__website_sessions",
        "src__website_pageviews",
        "src__orders",
        "src__order_items",
        "src__order_item_refunds",
        "src__products"
      ],
      "quality_gate": "All source models align exactly to the supplied files and row counts.",
      "prompt_file": ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-01-source-intake.md",
      "ir_file": ".claude/skills/toy-store-revenue-leak-observatory/ir/stage-01.json"
    },
    {
      "stage_id": 2,
      "stage_name": "canonical_commerce_graph",
      "goal": "Build stable staging and intermediate models that later stages can reference with ref().",
      "must_read_first": [
        ".claude/skills/toy-store-revenue-leak-observatory/phase-plan.json",
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/model-registry.json",
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/join-contracts.json",
        ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-02-canonical-commerce-graph.md"
      ],
      "depends_on_stages": [
        1
      ],
      "outputs": [
        "stg__website_sessions",
        "stg__website_pageviews",
        "stg__orders",
        "stg__order_items",
        "stg__order_item_refunds",
        "dim__products",
        "int__session_entry_page",
        "int__session_page_sequence",
        "int__session_order_bridge",
        "int__order_item_net_value"
      ],
      "quality_gate": "Every intermediate model has the declared grain and uses ref() for stage-1 inputs.",
      "prompt_file": ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-02-canonical-commerce-graph.md",
      "ir_file": ".claude/skills/toy-store-revenue-leak-observatory/ir/stage-02.json"
    },
    {
      "stage_id": 3,
      "stage_name": "acquisition_journey_and_experiments",
      "goal": "Diagnose traffic, landing-page, funnel, and checkout leaks while respecting valid comparison windows for experiments.",
      "must_read_first": [
        "datasets/maven-fuzzy-factory/profiles/page-catalog.json",
        "datasets/maven-fuzzy-factory/profiles/traffic-catalog.json",
        ".claude/skills/toy-store-revenue-leak-observatory/docs/known-quirks.md",
        ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-03-acquisition-journey-experiments.md"
      ],
      "depends_on_stages": [
        1,
        2
      ],
      "outputs": [
        "mart__traffic_source_day",
        "mart__landing_page_day",
        "mart__funnel_step_day",
        "mart__campaign_variant_day",
        "mart__checkout_variant_day",
        "diag__acquisition_leak",
        "diag__journey_leak",
        "diag__experiment_findings"
      ],
      "quality_gate": "Variant comparisons are restricted to overlap windows and all upstream internal dependencies use ref().",
      "prompt_file": ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-03-acquisition-journey-experiments.md",
      "ir_file": ".claude/skills/toy-store-revenue-leak-observatory/ir/stage-03.json"
    },
    {
      "stage_id": 4,
      "stage_name": "product_basket_refunds_and_launches",
      "goal": "Diagnose post-purchase value leakage through basket structure, refunds, and launch-window economics.",
      "must_read_first": [
        "datasets/maven-fuzzy-factory/profiles/chronology-summary.json",
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/metric-catalog.json",
        ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-04-product-basket-refund.md"
      ],
      "depends_on_stages": [
        1,
        2,
        3
      ],
      "outputs": [
        "mart__product_day",
        "mart__primary_product_cohort",
        "mart__bundle_attachment",
        "mart__refund_rate_day",
        "diag__basket_leak",
        "diag__refund_leak",
        "diag__launch_leak"
      ],
      "quality_gate": "Launch analyses use product launch timestamps and refund metrics use post-order refund data correctly.",
      "prompt_file": ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-04-product-basket-refund.md",
      "ir_file": ".claude/skills/toy-store-revenue-leak-observatory/ir/stage-04.json"
    },
    {
      "stage_id": 5,
      "stage_name": "observatory_and_action_layer",
      "goal": "Unify diagnostic outputs into a decision-ready observatory with ranked actions and plain-language explanations.",
      "must_read_first": [
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/metric-catalog.json",
        ".claude/skills/toy-store-revenue-leak-observatory/contracts/acceptance-tests.json",
        ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-05-observatory-action-layer.md"
      ],
      "depends_on_stages": [
        1,
        2,
        3,
        4
      ],
      "outputs": [
        "obs__leak_registry",
        "obs__priority_actions",
        "obs__executive_scorecard",
        "obs__leak_explainers"
      ],
      "quality_gate": "Every final observatory row is explainable, ranked, and traceable to supporting upstream models.",
      "prompt_file": ".claude/skills/toy-store-revenue-leak-observatory/prompts/iteration-05-observatory-action-layer.md",
      "ir_file": ".claude/skills/toy-store-revenue-leak-observatory/ir/stage-05.json"
    }
  ]
}
